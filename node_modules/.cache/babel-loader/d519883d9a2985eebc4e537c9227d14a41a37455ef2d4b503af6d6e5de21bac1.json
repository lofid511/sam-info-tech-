{"ast":null,"code":"import _objectSpread from\"C:/Users/R-TECH/Desktop/00/my-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// pointage.js\n// Pointage modal updated to make \"avance\" read-only and taken from the personel table.\n// - The advance value is displayed (not editable) and is taken from selectedPersonnel.avance (or 0).\n// - The save payload no longer sends an 'avance' value (backend will read personel.avance).\n// - Salary per day still uses saved salary_per_day when available, otherwise computed from personnel.salaire.\n// - Numbers formatted as \"5 000.00\" and rendered in an LTR span so Arabic pages don't reverse digits.\nimport React,{useEffect,useState}from\"react\";import ReactDOM from\"react-dom/client\";// Helpers\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function monthName(monthIndex){let locale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"fr\";const monthsFr=[\"Janvier\",\"Février\",\"Mars\",\"Avril\",\"Mai\",\"Juin\",\"Juillet\",\"Août\",\"Septembre\",\"Octobre\",\"Novembre\",\"Décembre\"];const monthsAr=[\"يناير\",\"فيفري\",\"مارس\",\"أبريل\",\"ماي\",\"جوان\",\"جويلية\",\"أوت\",\"سبتمبر\",\"أكتوبر\",\"نوفمبر\",\"ديسمبر\"];return(locale===\"ar\"?monthsAr:monthsFr)[monthIndex];}function getWorkingDays(year,month){// returns Date objects for all days in month except Fridays (Friday = 5)\nconst days=[];const d=new Date(year,month,1);while(d.getMonth()===month){// In JS: Sunday=0, Monday=1, ... Friday=5, Saturday=6\nif(d.getDay()!==5){days.push(new Date(d));}d.setDate(d.getDate()+1);}return days;}function formatDateISO(d){if(!d)return\"\";const yyyy=d.getFullYear();const mm=String(d.getMonth()+1).padStart(2,\"0\");const dd=String(d.getDate()).padStart(2,\"0\");return\"\".concat(yyyy,\"-\").concat(mm,\"-\").concat(dd);}function parseNumber(value){if(value===null||value===undefined||value===\"\")return 0;const s=String(value).replace(/\\s+/g,\"\").replace(\",\",\".\");const n=Number(s);return Number.isFinite(n)?n:0;}// Helper: format number with space thousands and dot decimal\nfunction formatNumberSpaceDot(value){if(value===null||value===undefined||value===\"\")return\"\";const cleaned=String(value).replace(/\\s+/g,\"\").replace(\",\",\".\");const n=Number(cleaned);if(!Number.isFinite(n))return String(value);const parts=n.toFixed(2).split(\".\");parts[0]=parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g,\" \");return parts.join(\".\");}// Modal component\nfunction PointageModal(_ref){var _selectedPersonnel$sa,_selectedPersonnel$av;let{detail={},onClose}=_ref;const locale=detail.locale||\"fr\";const T={fr:{title:\"Pointage / Calcul salaire\",selectPersonnel:\"Sélectionner le personnel\",monthLabel:\"Mois\",yearLabel:\"Année\",workingDaysNote:\"Jours ouvrables (vendredis exclus)\",presentLabel:\"Présent\",daysPresent:\"Présences\",salaryPerDay:\"Salaire par jour\",salaryDue:\"Salaire dû\",advance:\"Avance\",save:\"Enregistrer le pointage\",close:\"Fermer\",loading:\"Chargement...\",noPersonnel:\"Aucun personnel sélectionné.\",savedOK:\"Pointage enregistré.\"},ar:{title:\"تسجيل الحضور / حساب الراتب\",selectPersonnel:\"اختر الموظف\",monthLabel:\"الشهر\",yearLabel:\"السنة\",workingDaysNote:\"أيام العمل (باستثناء الجمعة)\",presentLabel:\"حاضر\",daysPresent:\"الحضور\",salaryPerDay:\"الراتب اليومي\",salaryDue:\"المبلغ المستحق\",advance:\"السلفة\",save:\"حفظ التسجيل\",close:\"إغلاق\",loading:\"جاري التحميل...\",noPersonnel:\"لم يتم اختيار موظف.\",savedOK:\"تم حفظ التسجيل.\"}}[locale];const[personnelList,setPersonnelList]=useState([]);const[selectedPersonnel,setSelectedPersonnel]=useState(detail.personnel||null);const now=new Date();const[year,setYear]=useState(now.getFullYear());const[month,setMonth]=useState(now.getMonth());// 0-11\nconst[workingDays,setWorkingDays]=useState([]);const[presentMap,setPresentMap]=useState({});// isoDate -> boolean\nconst[isSaving,setIsSaving]=useState(false);const[loadingPersonnel,setLoadingPersonnel]=useState(false);const[error,setError]=useState(\"\");// track salaryPerDay override from existing monthly record (if any)\nconst[salaryPerDayOverride,setSalaryPerDayOverride]=useState(null);// build working days when month/year changes\nuseEffect(()=>{const days=getWorkingDays(year,month);setWorkingDays(days);// initialize presentMap: default true for each day unless previously set\nsetPresentMap(prev=>{const map={};days.forEach(d=>{const iso=formatDateISO(d);map[iso]=prev.hasOwnProperty(iso)?prev[iso]:true;});return map;});setSalaryPerDayOverride(null);},[year,month]);// if no personnel passed, fetch personnel list\nuseEffect(()=>{let mounted=true;async function loadPersonnel(){if(selectedPersonnel)return;setLoadingPersonnel(true);try{var _window$pywebview,_window$pywebview$api,_window$pywebview$api2;const res=await((_window$pywebview=window.pywebview)===null||_window$pywebview===void 0?void 0:(_window$pywebview$api=_window$pywebview.api)===null||_window$pywebview$api===void 0?void 0:(_window$pywebview$api2=_window$pywebview$api.get_personnel)===null||_window$pywebview$api2===void 0?void 0:_window$pywebview$api2.call(_window$pywebview$api));if(!mounted)return;setPersonnelList(Array.isArray(res)?res:[]);}catch(e){console.error(\"pointage: failed to load personnel\",e);setPersonnelList([]);}finally{setLoadingPersonnel(false);}}loadPersonnel();return()=>{mounted=false;};},[selectedPersonnel]);// load existing pointage for this personnel/year/month if exists\nuseEffect(()=>{let mounted=true;async function loadExisting(){if(!selectedPersonnel||!selectedPersonnel.id)return;try{var _window$pywebview2,_window$pywebview2$ap,_window$pywebview2$ap2;const rec=await((_window$pywebview2=window.pywebview)===null||_window$pywebview2===void 0?void 0:(_window$pywebview2$ap=_window$pywebview2.api)===null||_window$pywebview2$ap===void 0?void 0:(_window$pywebview2$ap2=_window$pywebview2$ap.get_pointage_for_person_month)===null||_window$pywebview2$ap2===void 0?void 0:_window$pywebview2$ap2.call(_window$pywebview2$ap,selectedPersonnel.id,year,month+1));if(!mounted)return;if(rec){// prefill dates_present\nlet dates=rec.dates_present||rec.dates_present_text||rec.dates_present_json||null;if(typeof dates===\"string\"){try{dates=JSON.parse(dates);}catch(e){dates=null;}}if(Array.isArray(dates)){const map={};const days=getWorkingDays(year,month);days.forEach(d=>{const iso=formatDateISO(d);map[iso]=dates.includes(iso);});setPresentMap(map);}// if salary_per_day saved in record, use it as override\nif(rec.salary_per_day!==undefined&&rec.salary_per_day!==null){setSalaryPerDayOverride(parseNumber(rec.salary_per_day));}else{setSalaryPerDayOverride(null);}}else{// no record: reset present map defaults (already handled above)\nsetSalaryPerDayOverride(null);}}catch(e){console.warn(\"pointage: no existing record or failed to load\",e);}}loadExisting();return()=>{mounted=false;};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[selectedPersonnel,year,month]);const totalWorkingDays=workingDays.length;const daysPresent=Object.values(presentMap).filter(Boolean).length;const monthlySalary=parseNumber(selectedPersonnel&&((_selectedPersonnel$sa=selectedPersonnel.salaire)!==null&&_selectedPersonnel$sa!==void 0?_selectedPersonnel$sa:selectedPersonnel.salary)||0);// if there is a salaryPerDayOverride (saved), use it; otherwise compute from monthlySalary / totalWorkingDays\nconst salaryPerDay=salaryPerDayOverride!==null?salaryPerDayOverride:totalWorkingDays>0?monthlySalary/totalWorkingDays:0;// IMPORTANT: advance is read-only and comes from personel.avance (not editable here)\nconst personelAvance=parseNumber(selectedPersonnel&&((_selectedPersonnel$av=selectedPersonnel.avance)!==null&&_selectedPersonnel$av!==void 0?_selectedPersonnel$av:selectedPersonnel.advance)||0);// salaryDue uses personel-level avance (backend will also use personel.avance when saving)\nconst salaryDue=salaryPerDay*daysPresent-personelAvance;function toggleDay(iso){setPresentMap(prev=>_objectSpread(_objectSpread({},prev),{},{[iso]:!prev[iso]}));}async function handleSave(){if(!selectedPersonnel||!selectedPersonnel.id){setError(T.noPersonnel);return;}setError(\"\");setIsSaving(true);const payload={personnel_id:selectedPersonnel.id,year,month:month+1,// 1..12\ndays_total:totalWorkingDays,days_present:daysPresent,salary_per_day:salaryPerDay,salary_due:salaryDue,// DO NOT include 'avance' here: backend enforces personel.avance as canonical source\ndates_present:Object.entries(presentMap).filter(_ref2=>{let[k,v]=_ref2;return v;}).map(_ref3=>{let[k]=_ref3;return k;})};console.log(\"pointage: saving payload\",payload);try{if(window.pywebview&&window.pywebview.api&&window.pywebview.api.save_pointage){const result=await window.pywebview.api.save_pointage(payload);console.log(\"pointage: save result\",result);}else{// fallback: store in localStorage for demo\nconst key=\"pointage_\".concat(selectedPersonnel.id,\"_\").concat(year,\"_\").concat(month+1);localStorage.setItem(key,JSON.stringify(payload));console.log(\"pointage: saved to localStorage\",key);}setIsSaving(false);alert(T.savedOK);onClose();}catch(e){console.error(\"pointage: save failed\",e);setError((locale===\"fr\"?\"Erreur lors de l'enregistrement.\":\"فشل الحفظ.\")+(e!==null&&e!==void 0&&e.message?\" \".concat(e.message):\"\"));setIsSaving(false);}}function handleSelectPersonnelId(id){const p=personnelList.find(x=>String(x.id)===String(id));setSelectedPersonnel(p||null);// reset present map when switching person\nconst days=getWorkingDays(year,month);const map={};days.forEach(d=>{map[formatDateISO(d)]=true;});setPresentMap(map);setSalaryPerDayOverride(null);}// Render\nconst currencySuffix=locale===\"ar\"?\" دج\":\" DZD\";return/*#__PURE__*/_jsx(\"div\",{style:styles.overlay,children:/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},styles.modal),{},{direction:locale===\"ar\"?\"rtl\":\"ltr\",textAlign:locale===\"ar\"?\"right\":\"left\"}),children:[/*#__PURE__*/_jsxs(\"div\",{style:styles.header,children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:0},children:T.title}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,style:styles.closeButton,children:\"\\u2716\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:styles.controlsRow,children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"label\",{style:styles.labelSmall,children:T.selectPersonnel}),selectedPersonnel?/*#__PURE__*/_jsxs(\"div\",{style:styles.personnelCard,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"strong\",{children:[selectedPersonnel.nom,\" \",selectedPersonnel.prenom]}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:12,color:\"#666\"},children:selectedPersonnel.poste||\"\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:12},children:locale===\"fr\"?\"Salaire mensuel\":\"الراتب الشهري\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700},children:/*#__PURE__*/_jsxs(\"span\",{style:{direction:\"ltr\",unicodeBidi:\"isolate\"},children:[formatNumberSpaceDot(monthlySalary),currencySuffix]})})]})]}):loadingPersonnel?/*#__PURE__*/_jsx(\"div\",{children:T.loading}):/*#__PURE__*/_jsxs(\"select\",{style:styles.select,defaultValue:\"\",onChange:e=>handleSelectPersonnelId(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:locale===\"fr\"?\"— Select —\":\"— اختر —\"}),personnelList.map(p=>/*#__PURE__*/_jsxs(\"option\",{value:p.id,children:[p.nom,\" \",p.prenom,\" \",p.poste?\" - \".concat(p.poste):\"\"]},p.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{width:260},children:[/*#__PURE__*/_jsxs(\"label\",{style:styles.labelSmall,children:[T.monthLabel,\" / \",T.yearLabel]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:8},children:[/*#__PURE__*/_jsx(\"select\",{value:month,onChange:e=>setMonth(Number(e.target.value)),style:styles.select,children:Array.from({length:12}).map((_,i)=>/*#__PURE__*/_jsx(\"option\",{value:i,children:monthName(i,locale)},i))}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:year,onChange:e=>setYear(Number(e.target.value)),style:_objectSpread(_objectSpread({},styles.select),{},{width:100})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:6,fontSize:12,color:\"#666\"},children:[totalWorkingDays,\" \",locale===\"fr\"?\"jours ouvrables\":\"أيام عمل\",\" (\",locale===\"fr\"?\"vendredis exclus\":\"باستثناء الجمعة\",\")\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700,marginBottom:8},children:T.workingDaysNote}),/*#__PURE__*/_jsx(\"div\",{style:styles.daysGrid,children:workingDays.map(d=>{const iso=formatDateISO(d);const label=\"\".concat(String(d.getDate()).padStart(2,\"0\"),\"/\").concat(String(d.getMonth()+1).padStart(2,\"0\"));const weekday=d.toLocaleDateString(locale===\"fr\"?\"fr-FR\":\"ar\",{weekday:\"short\"});return/*#__PURE__*/_jsxs(\"label\",{style:styles.dayItem,children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:!!presentMap[iso],onChange:()=>toggleDay(iso)}),/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:8},children:/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:13},children:[label,\" \",/*#__PURE__*/_jsxs(\"span\",{style:{color:\"#666\",fontSize:12},children:[\"(\",weekday,\")\"]})]})})]},iso);})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12,display:\"flex\",gap:12,alignItems:\"center\",justifyContent:\"space-between\"},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:14,color:\"#666\"},children:T.daysPresent}),/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:700,fontSize:18},children:[daysPresent,\" / \",totalWorkingDays]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:\"#666\"},children:T.salaryPerDay}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700},children:/*#__PURE__*/_jsxs(\"span\",{style:{direction:\"ltr\",unicodeBidi:\"isolate\"},children:[formatNumberSpaceDot(salaryPerDay),currencySuffix]})}),/*#__PURE__*/_jsx(\"div\",{style:{height:6}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:\"#666\"},children:T.salaryDue}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:900,fontSize:18,color:salaryDue<0?\"#c00\":\"#14355f\"},children:/*#__PURE__*/_jsxs(\"span\",{style:{direction:\"ltr\",unicodeBidi:\"isolate\"},children:[formatNumberSpaceDot(salaryDue),currencySuffix]})}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:11,color:\"#666\",marginTop:8},children:[T.advance,\":\",\" \",/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:700},children:/*#__PURE__*/_jsxs(\"span\",{style:{direction:\"ltr\",unicodeBidi:\"isolate\"},children:[formatNumberSpaceDot(personelAvance),currencySuffix]})})]})]})]}),error&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8,color:\"red\"},children:error}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:14,display:\"flex\",gap:8,justifyContent:\"flex-end\"},children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,style:styles.btnSecondary,children:T.close}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,style:styles.btnPrimary,disabled:isSaving||!selectedPersonnel,children:isSaving?locale===\"fr\"?\"Enregistrement...\":\"جاري الحفظ...\":T.save})]})]})});}// Programmatic opener: mount modal into document.body\nexport function openPointage(){let detail=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};console.log(\"[pointage] openPointage called with detail:\",detail);const id=\"pointage-modal-root\";let container=document.getElementById(id);if(!container){container=document.createElement(\"div\");container.id=id;document.body.appendChild(container);}function cleanup(root,containerEl){try{root.unmount();}catch(e){/* ignore */}try{containerEl.remove();}catch(e){/* ignore */}}try{const root=ReactDOM.createRoot(container);const onClose=()=>cleanup(root,container);root.render(/*#__PURE__*/_jsx(PointageModal,{detail:detail,onClose:onClose}));}catch(err){// fallback for older React\ntry{const onClose=()=>{try{ReactDOM.unmountComponentAtNode(container);}catch(e){}try{container.remove();}catch(e){}};// eslint-disable-next-line\nReactDOM.render(/*#__PURE__*/_jsx(PointageModal,{detail:detail,onClose:onClose}),container);}catch(e){console.error(\"[pointage] failed to render modal:\",e);alert(\"Failed to open pointage (see console).\");}}}// Event listener registration so dispatching the custom event works\nfunction onOpenPointageEvent(e){try{console.log(\"[pointage] openPointage event received:\",e===null||e===void 0?void 0:e.detail);openPointage((e===null||e===void 0?void 0:e.detail)||{});}catch(err){console.error(\"[pointage] event handler error:\",err);}}try{window.__pointageLoaded=true;window.addEventListener(\"openPointage\",onOpenPointageEvent);window.openPointage=window.openPointage||openPointage;console.log(\"[pointage] module loaded. Listener registered. window.__pointageLoaded=true\");}catch(e){console.error(\"[pointage] could not register openPointage listener:\",e);}// Styles (inline simple styles)\nconst styles={overlay:{position:\"fixed\",inset:0,background:\"rgba(0,0,0,0.45)\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",zIndex:9999},modal:{width:\"94%\",maxWidth:980,background:\"#fff\",borderRadius:10,padding:16,boxShadow:\"0 12px 40px rgba(0,0,0,0.35)\"},header:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\"},closeButton:{border:\"none\",background:\"transparent\",fontSize:18,cursor:\"pointer\"},controlsRow:{display:\"flex\",gap:12,alignItems:\"flex-start\"},labelSmall:{fontSize:12,color:\"#333\",marginBottom:6,display:\"block\"},select:{padding:\"0.45rem 0.6rem\",borderRadius:6,border:\"1px solid #ccc\",background:\"#fff\",fontSize:14,width:\"100%\"},personnelCard:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",padding:\"8px 10px\",border:\"1px solid #e9eef9\",borderRadius:8,background:\"#fbfdff\"},daysGrid:{display:\"grid\",gridTemplateColumns:\"repeat(auto-fit, minmax(160px, 1fr))\",gap:8,maxHeight:320,overflowY:\"auto\",padding:6,border:\"1px solid #eef3fb\",borderRadius:6,background:\"#fff\"},dayItem:{display:\"flex\",alignItems:\"center\",gap:8,padding:\"6px 8px\",borderRadius:6,background:\"#fbfbff\",border:\"1px solid #f0f6ff\",fontSize:13},btnPrimary:{padding:\"0.6rem 1rem\",background:\"#3477eb\",color:\"#fff\",border:\"none\",borderRadius:6,cursor:\"pointer\",fontWeight:700},btnSecondary:{padding:\"0.5rem 0.9rem\",background:\"#f4f6fb\",border:\"none\",borderRadius:6,cursor:\"pointer\"}};export default openPointage;","map":{"version":3,"names":["React","useEffect","useState","ReactDOM","jsx","_jsx","jsxs","_jsxs","monthName","monthIndex","locale","arguments","length","undefined","monthsFr","monthsAr","getWorkingDays","year","month","days","d","Date","getMonth","getDay","push","setDate","getDate","formatDateISO","yyyy","getFullYear","mm","String","padStart","dd","concat","parseNumber","value","s","replace","n","Number","isFinite","formatNumberSpaceDot","cleaned","parts","toFixed","split","join","PointageModal","_ref","_selectedPersonnel$sa","_selectedPersonnel$av","detail","onClose","T","fr","title","selectPersonnel","monthLabel","yearLabel","workingDaysNote","presentLabel","daysPresent","salaryPerDay","salaryDue","advance","save","close","loading","noPersonnel","savedOK","ar","personnelList","setPersonnelList","selectedPersonnel","setSelectedPersonnel","personnel","now","setYear","setMonth","workingDays","setWorkingDays","presentMap","setPresentMap","isSaving","setIsSaving","loadingPersonnel","setLoadingPersonnel","error","setError","salaryPerDayOverride","setSalaryPerDayOverride","prev","map","forEach","iso","hasOwnProperty","mounted","loadPersonnel","_window$pywebview","_window$pywebview$api","_window$pywebview$api2","res","window","pywebview","api","get_personnel","call","Array","isArray","e","console","loadExisting","id","_window$pywebview2","_window$pywebview2$ap","_window$pywebview2$ap2","rec","get_pointage_for_person_month","dates","dates_present","dates_present_text","dates_present_json","JSON","parse","includes","salary_per_day","warn","totalWorkingDays","Object","values","filter","Boolean","monthlySalary","salaire","salary","personelAvance","avance","toggleDay","_objectSpread","handleSave","payload","personnel_id","days_total","days_present","salary_due","entries","_ref2","k","v","_ref3","log","save_pointage","result","key","localStorage","setItem","stringify","alert","message","handleSelectPersonnelId","p","find","x","currencySuffix","style","styles","overlay","children","modal","direction","textAlign","header","margin","onClick","closeButton","controlsRow","flex","labelSmall","personnelCard","nom","prenom","fontSize","color","poste","fontWeight","unicodeBidi","select","defaultValue","onChange","target","width","display","gap","from","_","i","type","marginTop","marginBottom","daysGrid","label","weekday","toLocaleDateString","dayItem","checked","marginLeft","alignItems","justifyContent","height","btnSecondary","btnPrimary","disabled","openPointage","container","document","getElementById","createElement","body","appendChild","cleanup","root","containerEl","unmount","remove","createRoot","render","err","unmountComponentAtNode","onOpenPointageEvent","__pointageLoaded","addEventListener","position","inset","background","zIndex","maxWidth","borderRadius","padding","boxShadow","border","cursor","gridTemplateColumns","maxHeight","overflowY"],"sources":["C:/Users/R-TECH/Desktop/00/my-app/src/pointage.js"],"sourcesContent":["// pointage.js\n// Pointage modal updated to make \"avance\" read-only and taken from the personel table.\n// - The advance value is displayed (not editable) and is taken from selectedPersonnel.avance (or 0).\n// - The save payload no longer sends an 'avance' value (backend will read personel.avance).\n// - Salary per day still uses saved salary_per_day when available, otherwise computed from personnel.salaire.\n// - Numbers formatted as \"5 000.00\" and rendered in an LTR span so Arabic pages don't reverse digits.\n\nimport React, { useEffect, useState } from \"react\";\nimport ReactDOM from \"react-dom/client\";\n\n// Helpers\nfunction monthName(monthIndex, locale = \"fr\") {\n  const monthsFr = [\"Janvier\",\"Février\",\"Mars\",\"Avril\",\"Mai\",\"Juin\",\"Juillet\",\"Août\",\"Septembre\",\"Octobre\",\"Novembre\",\"Décembre\"];\n  const monthsAr = [\"يناير\",\"فيفري\",\"مارس\",\"أبريل\",\"ماي\",\"جوان\",\"جويلية\",\"أوت\",\"سبتمبر\",\"أكتوبر\",\"نوفمبر\",\"ديسمبر\"];\n  return (locale === \"ar\" ? monthsAr : monthsFr)[monthIndex];\n}\n\nfunction getWorkingDays(year, month) {\n  // returns Date objects for all days in month except Fridays (Friday = 5)\n  const days = [];\n  const d = new Date(year, month, 1);\n  while (d.getMonth() === month) {\n    // In JS: Sunday=0, Monday=1, ... Friday=5, Saturday=6\n    if (d.getDay() !== 5) {\n      days.push(new Date(d));\n    }\n    d.setDate(d.getDate() + 1);\n  }\n  return days;\n}\n\nfunction formatDateISO(d) {\n  if (!d) return \"\";\n  const yyyy = d.getFullYear();\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  const dd = String(d.getDate()).padStart(2, \"0\");\n  return `${yyyy}-${mm}-${dd}`;\n}\n\nfunction parseNumber(value) {\n  if (value === null || value === undefined || value === \"\") return 0;\n  const s = String(value).replace(/\\s+/g, \"\").replace(\",\", \".\");\n  const n = Number(s);\n  return Number.isFinite(n) ? n : 0;\n}\n\n// Helper: format number with space thousands and dot decimal\nfunction formatNumberSpaceDot(value) {\n  if (value === null || value === undefined || value === \"\") return \"\";\n  const cleaned = String(value).replace(/\\s+/g, \"\").replace(\",\", \".\");\n  const n = Number(cleaned);\n  if (!Number.isFinite(n)) return String(value);\n  const parts = n.toFixed(2).split(\".\");\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \" \");\n  return parts.join(\".\");\n}\n\n// Modal component\nfunction PointageModal({ detail = {}, onClose }) {\n  const locale = detail.locale || \"fr\";\n  const T = {\n    fr: {\n      title: \"Pointage / Calcul salaire\",\n      selectPersonnel: \"Sélectionner le personnel\",\n      monthLabel: \"Mois\",\n      yearLabel: \"Année\",\n      workingDaysNote: \"Jours ouvrables (vendredis exclus)\",\n      presentLabel: \"Présent\",\n      daysPresent: \"Présences\",\n      salaryPerDay: \"Salaire par jour\",\n      salaryDue: \"Salaire dû\",\n      advance: \"Avance\",\n      save: \"Enregistrer le pointage\",\n      close: \"Fermer\",\n      loading: \"Chargement...\",\n      noPersonnel: \"Aucun personnel sélectionné.\",\n      savedOK: \"Pointage enregistré.\"\n    },\n    ar: {\n      title: \"تسجيل الحضور / حساب الراتب\",\n      selectPersonnel: \"اختر الموظف\",\n      monthLabel: \"الشهر\",\n      yearLabel: \"السنة\",\n      workingDaysNote: \"أيام العمل (باستثناء الجمعة)\",\n      presentLabel: \"حاضر\",\n      daysPresent: \"الحضور\",\n      salaryPerDay: \"الراتب اليومي\",\n      salaryDue: \"المبلغ المستحق\",\n      advance: \"السلفة\",\n      save: \"حفظ التسجيل\",\n      close: \"إغلاق\",\n      loading: \"جاري التحميل...\",\n      noPersonnel: \"لم يتم اختيار موظف.\",\n      savedOK: \"تم حفظ التسجيل.\"\n    }\n  }[locale];\n\n  const [personnelList, setPersonnelList] = useState([]);\n  const [selectedPersonnel, setSelectedPersonnel] = useState(detail.personnel || null);\n  const now = new Date();\n  const [year, setYear] = useState(now.getFullYear());\n  const [month, setMonth] = useState(now.getMonth()); // 0-11\n  const [workingDays, setWorkingDays] = useState([]);\n  const [presentMap, setPresentMap] = useState({}); // isoDate -> boolean\n  const [isSaving, setIsSaving] = useState(false);\n  const [loadingPersonnel, setLoadingPersonnel] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  // track salaryPerDay override from existing monthly record (if any)\n  const [salaryPerDayOverride, setSalaryPerDayOverride] = useState(null);\n\n  // build working days when month/year changes\n  useEffect(() => {\n    const days = getWorkingDays(year, month);\n    setWorkingDays(days);\n    // initialize presentMap: default true for each day unless previously set\n    setPresentMap(prev => {\n      const map = {};\n      days.forEach(d => {\n        const iso = formatDateISO(d);\n        map[iso] = prev.hasOwnProperty(iso) ? prev[iso] : true;\n      });\n      return map;\n    });\n    setSalaryPerDayOverride(null);\n  }, [year, month]);\n\n  // if no personnel passed, fetch personnel list\n  useEffect(() => {\n    let mounted = true;\n    async function loadPersonnel() {\n      if (selectedPersonnel) return;\n      setLoadingPersonnel(true);\n      try {\n        const res = await window.pywebview?.api?.get_personnel?.();\n        if (!mounted) return;\n        setPersonnelList(Array.isArray(res) ? res : []);\n      } catch (e) {\n        console.error(\"pointage: failed to load personnel\", e);\n        setPersonnelList([]);\n      } finally {\n        setLoadingPersonnel(false);\n      }\n    }\n    loadPersonnel();\n    return () => { mounted = false; };\n  }, [selectedPersonnel]);\n\n  // load existing pointage for this personnel/year/month if exists\n  useEffect(() => {\n    let mounted = true;\n    async function loadExisting() {\n      if (!selectedPersonnel || !selectedPersonnel.id) return;\n      try {\n        const rec = await window.pywebview?.api?.get_pointage_for_person_month?.(selectedPersonnel.id, year, month + 1);\n        if (!mounted) return;\n        if (rec) {\n          // prefill dates_present\n          let dates = rec.dates_present || rec.dates_present_text || rec.dates_present_json || null;\n          if (typeof dates === \"string\") {\n            try { dates = JSON.parse(dates); } catch (e) { dates = null; }\n          }\n          if (Array.isArray(dates)) {\n            const map = {};\n            const days = getWorkingDays(year, month);\n            days.forEach(d => {\n              const iso = formatDateISO(d);\n              map[iso] = dates.includes(iso);\n            });\n            setPresentMap(map);\n          }\n\n          // if salary_per_day saved in record, use it as override\n          if (rec.salary_per_day !== undefined && rec.salary_per_day !== null) {\n            setSalaryPerDayOverride(parseNumber(rec.salary_per_day));\n          } else {\n            setSalaryPerDayOverride(null);\n          }\n        } else {\n          // no record: reset present map defaults (already handled above)\n          setSalaryPerDayOverride(null);\n        }\n      } catch (e) {\n        console.warn(\"pointage: no existing record or failed to load\", e);\n      }\n    }\n    loadExisting();\n    return () => { mounted = false; };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedPersonnel, year, month]);\n\n  const totalWorkingDays = workingDays.length;\n  const daysPresent = Object.values(presentMap).filter(Boolean).length;\n\n  const monthlySalary = parseNumber((selectedPersonnel && (selectedPersonnel.salaire ?? selectedPersonnel.salary)) || 0);\n\n  // if there is a salaryPerDayOverride (saved), use it; otherwise compute from monthlySalary / totalWorkingDays\n  const salaryPerDay = salaryPerDayOverride !== null ? salaryPerDayOverride : (totalWorkingDays > 0 ? (monthlySalary / totalWorkingDays) : 0);\n\n  // IMPORTANT: advance is read-only and comes from personel.avance (not editable here)\n  const personelAvance = parseNumber((selectedPersonnel && (selectedPersonnel.avance ?? selectedPersonnel.advance)) || 0);\n\n  // salaryDue uses personel-level avance (backend will also use personel.avance when saving)\n  const salaryDue = (salaryPerDay * daysPresent) - personelAvance;\n\n  function toggleDay(iso) {\n    setPresentMap(prev => ({ ...prev, [iso]: !prev[iso] }));\n  }\n\n  async function handleSave() {\n    if (!selectedPersonnel || !selectedPersonnel.id) {\n      setError(T.noPersonnel);\n      return;\n    }\n    setError(\"\");\n    setIsSaving(true);\n    const payload = {\n      personnel_id: selectedPersonnel.id,\n      year,\n      month: month + 1, // 1..12\n      days_total: totalWorkingDays,\n      days_present: daysPresent,\n      salary_per_day: salaryPerDay,\n      salary_due: salaryDue,\n      // DO NOT include 'avance' here: backend enforces personel.avance as canonical source\n      dates_present: Object.entries(presentMap).filter(([k,v]) => v).map(([k]) => k)\n    };\n    console.log(\"pointage: saving payload\", payload);\n    try {\n      if (window.pywebview && window.pywebview.api && window.pywebview.api.save_pointage) {\n        const result = await window.pywebview.api.save_pointage(payload);\n        console.log(\"pointage: save result\", result);\n      } else {\n        // fallback: store in localStorage for demo\n        const key = `pointage_${selectedPersonnel.id}_${year}_${month+1}`;\n        localStorage.setItem(key, JSON.stringify(payload));\n        console.log(\"pointage: saved to localStorage\", key);\n      }\n      setIsSaving(false);\n      alert(T.savedOK);\n      onClose();\n    } catch (e) {\n      console.error(\"pointage: save failed\", e);\n      setError((locale === \"fr\" ? \"Erreur lors de l'enregistrement.\" : \"فشل الحفظ.\") + (e?.message ? ` ${e.message}` : \"\"));\n      setIsSaving(false);\n    }\n  }\n\n  function handleSelectPersonnelId(id) {\n    const p = personnelList.find(x => String(x.id) === String(id));\n    setSelectedPersonnel(p || null);\n    // reset present map when switching person\n    const days = getWorkingDays(year, month);\n    const map = {};\n    days.forEach(d => { map[formatDateISO(d)] = true; });\n    setPresentMap(map);\n    setSalaryPerDayOverride(null);\n  }\n\n  // Render\n  const currencySuffix = locale === \"ar\" ? \" دج\" : \" DZD\";\n\n  return (\n    <div style={styles.overlay}>\n      <div style={{ ...styles.modal, direction: locale === \"ar\" ? \"rtl\" : \"ltr\", textAlign: locale === \"ar\" ? \"right\" : \"left\" }}>\n        <div style={styles.header}>\n          <h3 style={{ margin: 0 }}>{T.title}</h3>\n          <button onClick={onClose} style={styles.closeButton}>✖</button>\n        </div>\n\n        <div style={styles.controlsRow}>\n          <div style={{ flex: 1 }}>\n            <label style={styles.labelSmall}>{T.selectPersonnel}</label>\n            {selectedPersonnel ? (\n              <div style={styles.personnelCard}>\n                <div>\n                  <strong>{selectedPersonnel.nom} {selectedPersonnel.prenom}</strong>\n                  <div style={{ fontSize: 12, color: \"#666\" }}>{selectedPersonnel.poste || \"\"}</div>\n                </div>\n                <div style={{ textAlign: \"right\" }}>\n                  <div style={{ fontSize: 12 }}>{locale === \"fr\" ? \"Salaire mensuel\" : \"الراتب الشهري\"}</div>\n                  <div style={{ fontWeight: 700 }}>\n                    <span style={{ direction: \"ltr\", unicodeBidi: \"isolate\" }}>\n                      {formatNumberSpaceDot(monthlySalary)}{currencySuffix}\n                    </span>\n                  </div>\n                </div>\n              </div>\n            ) : (\n              loadingPersonnel ? <div>{T.loading}</div> : (\n                <select style={styles.select} defaultValue=\"\" onChange={(e) => handleSelectPersonnelId(e.target.value)}>\n                  <option value=\"\">{locale === \"fr\" ? \"— Select —\" : \"— اختر —\"}</option>\n                  {personnelList.map(p => (\n                    <option key={p.id} value={p.id}>{p.nom} {p.prenom} {p.poste ? ` - ${p.poste}` : \"\"}</option>\n                  ))}\n                </select>\n              )\n            )}\n          </div>\n\n          <div style={{ width: 260 }}>\n            <label style={styles.labelSmall}>{T.monthLabel} / {T.yearLabel}</label>\n            <div style={{ display: \"flex\", gap: 8 }}>\n              <select value={month} onChange={(e) => setMonth(Number(e.target.value))} style={styles.select}>\n                {Array.from({ length: 12 }).map((_, i) => <option key={i} value={i}>{monthName(i, locale)}</option>)}\n              </select>\n              <input type=\"number\" value={year} onChange={(e) => setYear(Number(e.target.value))} style={{ ...styles.select, width: 100 }} />\n            </div>\n            <div style={{ marginTop: 6, fontSize: 12, color: \"#666\" }}>\n              {totalWorkingDays} {locale === \"fr\" ? \"jours ouvrables\" : \"أيام عمل\"} ({locale === \"fr\" ? \"vendredis exclus\" : \"باستثناء الجمعة\"})\n            </div>\n          </div>\n        </div>\n\n        <div style={{ marginTop: 12 }}>\n          <div style={{ fontWeight: 700, marginBottom: 8 }}>{T.workingDaysNote}</div>\n          <div style={styles.daysGrid}>\n            {workingDays.map(d => {\n              const iso = formatDateISO(d);\n              const label = `${String(d.getDate()).padStart(2,\"0\")}/${String(d.getMonth()+1).padStart(2,\"0\")}`;\n              const weekday = d.toLocaleDateString(locale === \"fr\" ? \"fr-FR\" : \"ar\", { weekday: \"short\" });\n              return (\n                <label key={iso} style={styles.dayItem}>\n                  <input type=\"checkbox\" checked={!!presentMap[iso]} onChange={() => toggleDay(iso)} />\n                  <div style={{ marginLeft: 8 }}>\n                    <div style={{ fontSize: 13 }}>{label} <span style={{ color: \"#666\", fontSize: 12 }}>({weekday})</span></div>\n                  </div>\n                </label>\n              );\n            })}\n          </div>\n        </div>\n\n        <div style={{ marginTop: 12, display: \"flex\", gap: 12, alignItems: \"center\", justifyContent: \"space-between\" }}>\n          <div>\n            <div style={{ fontSize: 14, color: \"#666\" }}>{T.daysPresent}</div>\n            <div style={{ fontWeight: 700, fontSize: 18 }}>{daysPresent} / {totalWorkingDays}</div>\n          </div>\n\n          <div style={{ textAlign: \"right\" }}>\n            <div style={{ fontSize: 13, color: \"#666\" }}>{T.salaryPerDay}</div>\n            <div style={{ fontWeight: 700 }}>\n              <span style={{ direction: \"ltr\", unicodeBidi: \"isolate\" }}>\n                {formatNumberSpaceDot(salaryPerDay)}{currencySuffix}\n              </span>\n            </div>\n            <div style={{ height: 6 }} />\n            <div style={{ fontSize: 13, color: \"#666\" }}>{T.salaryDue}</div>\n            <div style={{ fontWeight: 900, fontSize: 18, color: salaryDue < 0 ? \"#c00\" : \"#14355f\" }}>\n              <span style={{ direction: \"ltr\", unicodeBidi: \"isolate\" }}>\n                {formatNumberSpaceDot(salaryDue)}{currencySuffix}\n              </span>\n            </div>\n\n            {/* Advance is read-only and sourced from personel.avance */}\n            <div style={{ fontSize: 11, color: \"#666\", marginTop: 8 }}>\n              {T.advance}:{\" \"}\n              <span style={{ fontWeight: 700 }}>\n                <span style={{ direction: \"ltr\", unicodeBidi: \"isolate\" }}>\n                  {formatNumberSpaceDot(personelAvance)}{currencySuffix}\n                </span>\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {error && <div style={{ marginTop: 8, color: \"red\" }}>{error}</div>}\n\n        <div style={{ marginTop: 14, display: \"flex\", gap: 8, justifyContent: \"flex-end\" }}>\n          <button onClick={onClose} style={styles.btnSecondary}>{T.close}</button>\n          <button onClick={handleSave} style={styles.btnPrimary} disabled={isSaving || !selectedPersonnel}>\n            {isSaving ? (locale === \"fr\" ? \"Enregistrement...\" : \"جاري الحفظ...\") : T.save}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Programmatic opener: mount modal into document.body\nexport function openPointage(detail = {}) {\n  console.log(\"[pointage] openPointage called with detail:\", detail);\n  const id = \"pointage-modal-root\";\n  let container = document.getElementById(id);\n  if (!container) {\n    container = document.createElement(\"div\");\n    container.id = id;\n    document.body.appendChild(container);\n  }\n\n  function cleanup(root, containerEl) {\n    try { root.unmount(); } catch (e) { /* ignore */ }\n    try { containerEl.remove(); } catch (e) { /* ignore */ }\n  }\n\n  try {\n    const root = ReactDOM.createRoot(container);\n    const onClose = () => cleanup(root, container);\n    root.render(<PointageModal detail={detail} onClose={onClose} />);\n  } catch (err) {\n    // fallback for older React\n    try {\n      const onClose = () => {\n        try { ReactDOM.unmountComponentAtNode(container); } catch (e) {}\n        try { container.remove(); } catch (e) {}\n      };\n      // eslint-disable-next-line\n      ReactDOM.render(<PointageModal detail={detail} onClose={onClose} />, container);\n    } catch (e) {\n      console.error(\"[pointage] failed to render modal:\", e);\n      alert(\"Failed to open pointage (see console).\");\n    }\n  }\n}\n\n// Event listener registration so dispatching the custom event works\nfunction onOpenPointageEvent(e) {\n  try {\n    console.log(\"[pointage] openPointage event received:\", e?.detail);\n    openPointage(e?.detail || {});\n  } catch (err) {\n    console.error(\"[pointage] event handler error:\", err);\n  }\n}\n\ntry {\n  window.__pointageLoaded = true;\n  window.addEventListener(\"openPointage\", onOpenPointageEvent);\n  window.openPointage = window.openPointage || openPointage;\n  console.log(\"[pointage] module loaded. Listener registered. window.__pointageLoaded=true\");\n} catch (e) {\n  console.error(\"[pointage] could not register openPointage listener:\", e);\n}\n\n// Styles (inline simple styles)\nconst styles = {\n  overlay: {\n    position: \"fixed\",\n    inset: 0,\n    background: \"rgba(0,0,0,0.45)\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    zIndex: 9999\n  },\n  modal: {\n    width: \"94%\",\n    maxWidth: 980,\n    background: \"#fff\",\n    borderRadius: 10,\n    padding: 16,\n    boxShadow: \"0 12px 40px rgba(0,0,0,0.35)\"\n  },\n  header: {\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\"\n  },\n  closeButton: {\n    border: \"none\",\n    background: \"transparent\",\n    fontSize: 18,\n    cursor: \"pointer\"\n  },\n  controlsRow: {\n    display: \"flex\",\n    gap: 12,\n    alignItems: \"flex-start\"\n  },\n  labelSmall: {\n    fontSize: 12,\n    color: \"#333\",\n    marginBottom: 6,\n    display: \"block\"\n  },\n  select: {\n    padding: \"0.45rem 0.6rem\",\n    borderRadius: 6,\n    border: \"1px solid #ccc\",\n    background: \"#fff\",\n    fontSize: 14,\n    width: \"100%\"\n  },\n  personnelCard: {\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    padding: \"8px 10px\",\n    border: \"1px solid #e9eef9\",\n    borderRadius: 8,\n    background: \"#fbfdff\"\n  },\n  daysGrid: {\n    display: \"grid\",\n    gridTemplateColumns: \"repeat(auto-fit, minmax(160px, 1fr))\",\n    gap: 8,\n    maxHeight: 320,\n    overflowY: \"auto\",\n    padding: 6,\n    border: \"1px solid #eef3fb\",\n    borderRadius: 6,\n    background: \"#fff\"\n  },\n  dayItem: {\n    display: \"flex\",\n    alignItems: \"center\",\n    gap: 8,\n    padding: \"6px 8px\",\n    borderRadius: 6,\n    background: \"#fbfbff\",\n    border: \"1px solid #f0f6ff\",\n    fontSize: 13\n  },\n  btnPrimary: {\n    padding: \"0.6rem 1rem\",\n    background: \"#3477eb\",\n    color: \"#fff\",\n    border: \"none\",\n    borderRadius: 6,\n    cursor: \"pointer\",\n    fontWeight: 700\n  },\n  btnSecondary: {\n    padding: \"0.5rem 0.9rem\",\n    background: \"#f4f6fb\",\n    border: \"none\",\n    borderRadius: 6,\n    cursor: \"pointer\"\n  }\n};\n\nexport default openPointage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}